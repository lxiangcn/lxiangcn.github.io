<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
<link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/github.min.css">
<script>
  hljs.initHighlightingOnLoad();
</script>

<center><br /><br /><br /><br />
<div style="font-size:36pt;">在线合作机构接入接口说明</div><br /><br />
<div style="font-size:16pt;">(驴妈妈篇 -- Ver 0.7)</div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
比特空间 2015-04-26
</center>

#### 修订履历 ####

版本号 | 日期 | 修订者 | 变更内容
-------|--------|--------|-------
v0.1 | 2014-12-05 | 闵龙兵 | 新建
v0.2 | 2015-02-02 | 闵龙兵 | 追加新消息类型
v0.3 | 2015-03-16 | 闵龙兵 | 修正流程图
v0.4 | 2015-04-27 | 闵龙兵 | 合并对账接口；针对特定商户，增加实例
v0.5 | 2015-05-05 | 宁佳晨 | 添加查询接口GX0207:查询用户所有订单
v0.6 | 2015-05-07 | 宁佳晨 | 修改查询接口GX0206新增subtype 0107:申请待重新提交,添加APP_STATUS
v0.7 | 2015-05-14 | 宁佳晨 | 修改查询接口GX0207:查询指定订单



#### 1.1 接入简介 ####
本文档所描述之服务，针对于在线合作机构直接通过即科的着陆页面进行合作的场景。

目前的系统设计，比特空间与合作机构的系统的服务器之间通讯，采用带HTTP Digest验证的HTTP POST web调用。而对于合作机构的最终用户端与比特空间的服务器之间的通讯，采用标准的HTTP GET链接请求，具体URL拼接形式以及所需数据格式详情请参见后续章节。

#### 1.2 客户端调用的场景 ####
有用户确认场景的时序如下图所示：

<img src="LVMM/online_referral.png" title="有用户确认场景的时序" width="640" />

无用户确认场景的时序如下图所示：

<img src="LVMM/online_referral2.png" title="无用户确认场景的时序" width="640" />

#### 1.3 服务端调用的场景--对账接口 ####
目前的对账流程分为每日对账和每月对账。比特空间会在每晚夜间2:00发起面向商户的上一个自然日的数据对账调用请求。同时会在次月1日夜间3:00发起面向商户的上一个自然月的数据对账调用请求（具体时间点以及商户服务的URL可双方另行协商）。

即比特空间在与合作机构敲定系统接口时，应该共同商定如下表格内容：

项目 | 默认值 | 备注
-------|--------|--------|-------
每日对账时间 | 2:00 | 可另行协商调整
每月对账时间 | 3:00 | 可另行协商调整
对账完成通知URL | | 可选。对于希望自动对账的合作机构，可提供此URL，则比特空间系统会在完成对账之后，发送一HTTP POST到相应的接口，以通知响应的对账结果。
对账完成通知email | | 可选。对于希望财务手动对账的合作机构，可提供此email，则比特空间系统会在完成对账之后，发送响应的 email到该邮箱，以通知响应的对账结果。

具体调用时序图如下图所示：

<img src="LVMM/LVMM存款证明－－对账.png" title="对账流程" width="420" />


### 2. 交易接口说明 ###
除特殊说明的场合以外，所有的HTTP POST请求与返回数据格式都是application/json。
#### 2.1 HTTP POST通用请求消息头 ####
每一个json请求都包含于一个共同的通用请求消息头。基本的请求消息头格式如下：

```
{
    "MERCHANT_ID" : "商户ID",
    "TXN_CODE" : "请求类型",
    "TIME_STAMP" : "时间戳",
    "DATA" : {...}
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
MERCHANT_ID | 字符串 | - | 由即科统一分配的合作机构的唯一代码
TXN_CODE | 字符串 | - | 由即科系统提前配置的交易类型代码
TIME_STAMP | 日期 | YYYY-MM-DD HH:mm:SS | 交易发起时的当前日期时间戳
DATA | 字符串 | - | 请求的数据部分，无数据的场合内部为空

#### 2.2 HTTP POST通用回复消息头 ####
每一个json回复都包含于一个共同的通用回复消息头。基本的回复消息头格式如下 ：

```
{
    "TXN_CODE" : "请求类型",
    "TIME_STAMP" : "时间戳",
    "ERROR_CODE" : "错误代码",
    "MESSAGE" : "错误消息",
    "DATA" : {...}
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
TXN_CODE | 字符串 | - | 根据请求复制过来的请求类型
TIME_STAMP | 日期 | YYYY-MM-DD HH:mm:SS | 回复时的当前日期时间戳
ERROR_CODE | 整数 | - | 错误代码，默认0表示成功
MESSAGE | 字符串 | - | 错误消息
DATA | 字符串 | - | 回复的数据部分

#### 2.3 HTTP POST URL构成说明 ####
```
    基础URL + "/" + 动作名称 + "/" + 商户ID + "/" + 商户公开哈系代码 + "/" + 交易代码

```
字段说明:

序号 | 项目名 | 项目内部名称 | 说明
-------|--------|--------|-------
1 | 基础URL  | base_ul | 由比特空间提出来供合作机构调用的一个基础性URL。测试环境与生产环境会分别提供
2 | 动作名称  | action_name | 当前调用名称
3 | 商户ID  | merchant_id | 由即科提供的商户唯一编码
4 | 商户公开哈希代码  | hash | 由即科提供的商户公开哈希代码
5 | 交易代码  | txn_code | 预定义的交易代码

测试环境：

序号 | 项目名 | 项目内容 | 说明
-------|--------|--------|-------
1 | 基础URL  | http://test.geexfinance.com/merchant/service/|
2 | 动作名称  |  apis
3 | 商户ID  | lvmama |
4 | 商户公开哈希代码  | e38b077cb3eb7a5c21599999c8e8bsba |

生产环境：

序号 | 项目名 | 项目内容 | 说明
-------|--------|--------|-------
1 | 基础URL  | http://www.geexfinance.com/merchant/service/ |
2 | 动作名称  | apis
3 | 商户ID  | lvmama |
4 | 商户公开哈希代码  | e38b077cb3eb7a5c21599999c8e8bsba |



#### 2.4 HTTP GET URL构成说明 ####
除特殊说明的场合以外，后续的所有的HTTP GET请求调用都是根据以下一套规则来组成其最终的URL：

```
    基础URL + "/" + 动作名称 + "/" + 商户ID + "/" + 商户公开哈系代码 + "/" + 交易代码 + "/" + 扩展参数1,2,3.....
```
字段说明:

序号 | 项目名 | 项目内部名称 | 说明
-------|--------|--------|-------
1 | 基础URL  | base_ul | 由比特空间提出来供合作机构调用的一个基础性URL。测试环境与生产环境会分别提供
2 | 动作名称  | action_name | 当前调用名称
3 | 商户ID  | merchant_id | 由即科提供的商户唯一编码
4 | 商户公开哈希代码  | hash | 由即科提供的商户公开哈希代码
5 | 交易代码  | txn_code | 预定义的交易代码
6 | 扩展参数1,2,3  | extra_01 | 可选。根据具体商户业务需求与Txn Code可以有不同预配置。

以上必须信息，比特空间会另行线下提供。如下是针对驴妈妈的场景的配置信息。

测试环境：

序号 | 项目名 | 项目内容 | 说明
-------|--------|--------|-------
1 | 基础URL  | http://test.geexfinance.com/merchant/service/|
2 | 动作名称  |  refer
3 | 商户ID  | lvmama |
4 | 商户公开哈希代码  | e38b077cb3eb7a5c21599999c8e8bsba |

生产环境：

序号 | 项目名 | 项目内容 | 说明
-------|--------|--------|-------
1 | 基础URL  | http://www.geexfinance.com/merchant/service/ |
2 | 动作名称  | refer
3 | 商户ID  | lvmama |
4 | 商户公开哈希代码  | e38b077cb3eb7a5c21599999c8e8bsba |


#### 2.5 接口一览 ####

序号 | 交易代码 | 交易名称 | 交易方向 | 说明
-------|--------|--------|-------|-------
1 | GX0200 | 商户跳入请求 | 最终用户浏览器-->即科 | 从合作机构网站调入比特空间申请页面
2 | GX0201 | 商户对账请求 | 即科-->合作机构(商户) | 请求商户将上一个自然日、自然日的所有申请数据返回做对账用
3 | GX0202 | 金融机构对账请求 | 即科-->合作机构(金融机构) | 请求金融机构将上一个自然日、自然月的所有申请数据返回做对账用
4 | GX0203 | 对账完成通知 | 即科-->合作机构(商户 & 金融机构) | 可选。将对账结果反馈给所有相关合作机构
5 | GX0204 | 跳出通知 | 即科-->最终用户浏览器 | 可选。完成申请提交以后，比特空间将最终客户的浏览器重定向到合作机构预先给定的URL
6 | GX0205 | 合作机构查询、通知 | 合作机构-->即科 | 可选。合作机构后台查询通知比特空间申请状态及变化，具体通知消息需与合作机构另行商定。
7 | GX0206 | 比特空间查询、通知 | 即科-->合作机构 | 可选。比特空间后台查询通知合作机构申请状态及变化，具体通知消息需与合作机构另行商定。
8 | GX0207 | 查询指定订单 | 合作机构-->即科 | 可选。合作机构后台查询比特空间的指定申请。
9 | GX0208 | 商户跳入请求,带订单编号 | 最终用户浏览器-->即科 | 可选。从合作机构网站调入比特空间申请页面。
可选。合作机构查询某个用户的所有申请.

#### 2.6 错误代码一览表 ####

错误代码 | 错误消息
-------|--------
0  | 成功
101| 没有访问权限
102| 无效访问
103| 该数据字段为必填字段
104| 数据字段长度与规则不符
105| 数据规则校验失败
106| 系统内部错误
107| 系统暂时不可用
108| 接口开发中,暂时不可用

##### 2.7 对账冲突代码一览表 #####

冲突代码 | 冲突消息 | 备注
-------|--------|--------
0 | 对账成功 | －
101 | 申请状态不一致 | －
102 | 贷款类型不一致 | －
103 | 贷款金额不一致 | －
104 | 贷款期限不一致 | －
105 | 首付／手续费不一致 | －
106 | 批准金额不一致 | －
107 | 放款金额不一致 | －
201 | 批准日期不一致 | －
202 | 放款日期不一致 | －

### 3. 接口详情 ###
本节后续章节的输入输出参数均不包含通用请求头与回复头。

#### 3.1 商户跳入请求GX0200 ####
##### 3.1.1 接口描述 #####
从合作机构网站调入比特空间申请页面, 并将必要的参数以HTTP GET的形式传递到比特空间的服务器上。
##### 3.1.2 输入参数 #####
其URL构成为：

序号 | 项目名 | 类型 | 格式 | 备注
-------|--------|--------|-------|-------
5 | 交易代码  | 字符串 | 32 | 固定值"GX0200"
6 | 扩展参数1  | 字符串 | 32 | USER_ID ： 用户哈希ID，由合作提供提供并保证其唯一性的用户身份标识
7 | 扩展参数2  | 字符串 | 32 | CHNL_ID ：商机渠道信息
8 | 扩展参数3  | 字符串 | 32 | PDT_CAT ：商品种类信息，比特空间与合作机构线下协商的产品种类代码
9 | 扩展参数4  | 字符串 | 32 | OPPT_ID ： 全局商机唯一ID，比特空间会将其返回给合作机构用于商机跟踪

示例URL如:

```
    http://www.geexfinance.com/merchant/service/refer/lvmama/e38b077cb3eb7a5c21599999c8e8bsba/GX0200/ABC-12345/chnl001/pdt001/oppt001/
```
其中，数据如下：

序号 | 项目名 | 值
-------|--------|--------
1 | 基础URL  | http://www.geexfinance.com/merchant/service/(测试环境为http://test.geexfinance.com/merchant/service/)
2 | 动作名称  | refer
3 | 商户ID  | lvmama
4 | 商户公开哈系代码  | e38b077cb3eb7a5c21599999c8e8bsba
5 | 交易代码  | GX0200
6 | 扩展参数1 ：USER_ID | ABC-12345
7 | 扩展参数2 ：CHNL_ID | chnl_001
8 | 扩展参数3 ： PDT_CAT | pdt001
9 | 扩展参数4 ：OPPT_ID  | oppt001

##### 3.1.3 输出结果 #####
直接将用户浏览器带入到预配置的着陆页面，并同时将参数导入。

#### 3.2 商户对账请求GX0201 ####
##### 3.2.1 接口描述 #####
该接口请求商户将上一个自然日、自然月的所有申请数据返回做对账用
##### 3.2.2 输入参数 #####

```
"APP_DATE" : "20150217"
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_DATE | 字符串 | 8 | 申请日期，格式YYYYMMDD。日期位固定为00表示按月对账

##### 3.2.3 输出结果 #####

```
"APP_DATE" : "20150217",
"SYNC_DATE" : "20150220",
"TOTAL" : 2,
"RESULT" : {
    "APP_ID" : ["ABC01-20150217-123456","ABC01-20150217-000000"],
    "LOAN_PDT" : ["ABCD","ABCD"],
    "LOAN_AMT" : [9500,17500],
    "LOAN_TNR" : [6,12],
    "LOAN_DOWNPAY" : [0, 750],
    "CONFIRM_DATE" : ["2015-02-17 12:34:56","2015-02-18 12:34:56"],
    "APP_STATUS" : ["SBMT","APRV"],
    "EXT_UID" : ["1234567890-1", "1234567890-2"]
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_DATE | 字符串 | 8 | 申请日期，格式YYYYMMDD。
SYNC_DATE | 字符串 | 8 | 同步执行日期，格式YYYYMMDD。
TOTAL | 整形 | － | 返回数据集的大小
RESULT | - | － | 返回数据集集合
APP_ID | 字符串 | 19 | 全局唯一的申请号
LOAN_PDT | 字符串 | 4 | 贷款产品代码,合作商户线下另行协商
LOAN_AMT | 金额 | － | 贷款金额
LOAN_TNR | 整数 | － | 贷款期限（月数）
LOAN_DOWNPAY | 金额 | － | 贷款首付／手续费
CONFIRM_DATE | 时间戳 | － | 商户确认申请成立时间（如手续费缴费日期等）,YYYY-MM-DD HH:mm:SS（24小时制）
APP_STATUS | 字符串 | 4 | 当前申请状态（SAVE: 待提交、SBMT：已提交、DECL：已拒绝、APRV：已批准、DDWN：已放款、CANL：已取消、POFF：已还款毕、RESM:待重新提交、RETN:资料已打回）
EXT_UID | 字符串 | 32 | 外部唯一编号,如商户内部订单号、流水号等

#### 3.3 金融机构对账请求GX0202 ####
##### 3.3.1 接口描述 #####
该接口请求金融机构将上一个自然日、自然月的所有申请数据返回做对账用
##### 3.3.2 输入参数 #####

```
"APP_DATE" : "20150217"
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_DATE | 字符串 | 8 | 对账日期，格式YYYYMMDD。日期位固定为00表示按月对账

##### 3.3.3 输出结果 #####

```
"APP_DATE" : "20150217",
"SYNC_DATE" : "20150220",
"TOTAL" : 2,
"RESULT" : {
    "APP_ID" : ["ABC01-20150217-123456","ABC01-20150217-000000"],
    "LOAN_PDT" : ["ABCD","ABCD"],
    "LOAN_AMT" : [9500,17500],
    "LOAN_TNR" : [6,12],
    "LOAN_DOWNPAY" : [0, 750],
    "CONFIRM_DATE" : ["2014-02-17 12:34:56","2014-02-18 12:34:56"],
    "APP_STATUS" : ["SBMT","APRV"],
    "EXT_UID" : ["1234567890-1", "1234567890-2"],
    "APPV_AMT" : [9500,17500],
    "DD_AMT" : [9500,17500],
    "APPV_DATE" : ["2014-02-17 13:34:56","2014-02-18 13:34:56"],
    "DD_DATE" : ["2014-02-18 12:34:56","2014-02-19 12:34:56"]
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_DATE | 字符串 | 8 | 申请日期，格式YYYYMMDD。
SYNC_DATE | 字符串 | 8 | 同步执行日期，格式YYYYMMDD。
TOTAL | 整形 | － | 返回数据集的大小
RESULT | - | － | 返回数据集集合
APP_ID | 字符串 | 19 | 全局唯一的申请号
LOAN_PDT | 字符串 | 4 | 贷款产品代码,合作商户线下另行协商
LOAN_AMT | 金额 | － | 贷款金额
LOAN_TNR | 整数 | － | 贷款期限（月数）
LOAN_DOWNPAY | 金额 | － | 贷款首付／手续费
CONFIRM_DATE | 时间戳 | － | 金融机构接受申请时间（如手续费缴费日期等）,YYYY-MM-DD HH:mm:SS（24小时制）
APP_STATUS | 字符串 | 4 | 当前申请状态,合作商户线下另行协商
EXT_UID | 字符串 | 32 | 外部唯一编号,如金融机构内部订单号、流水号等
APPV_AMT | 金额 | － | 批准金额
DD_AMT | 金额 | － | 放款金额
APPV_DATE | 时间戳 | － | 批准时间,YYYY-MM-DD HH:mm:SS（24小时制）
DD_DATE | 时间戳 | － | 放款时间,YYYY-MM-DD HH:mm:SS（24小时制）

#### 3.4 对账完成通知GX0203 ####
##### 3.4.1 接口描述 #####
该接口请求在对账完成之后通知合作机构相关合作机构
##### 3.4.2 输入参数 #####

```
"APP_DATE" : "20150217",
"SYNC_DATE" : "20150220",
"TOTAL" : 3,
"COUNT_OK" : 2,
"COUNT_NG" : 1,
"RESULT" : {
    "APP_ID" : ["ABC01-20150217-123456"],
    "CONFLICT_CODE" : [100],
    "CONFLICT_MSG" : ["......"],
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_DATE | 字符串 | 8 | 申请日期，格式YYYYMMDD。日期位固定为00表示按月对账
SYNC_DATE | 字符串 | 8 | 同步执行日期，格式YYYYMMDD。
TOTAL | 整形 | － | 总对账申请单数
COUNT_OK | 整形 | － | 对账成功申请单数
COUNT_NG | 整形 | － | 对账冲突申请单数
RESULT | - | － | 对账冲突申请单集合
APP_ID | 字符串 | 19 | 全局唯一的申请号
CONFLICT_CODE | 整形 | - | 冲突代码，0表示无冲突，详情参见后文
CONFLICT_MSG | 字符串 | - | 冲突消息

##### 3.4.3 输出结果 #####
无定制

#### 3.5 跳出通知GX0204 ####
##### 3.5.1 接口描述 #####
完成申请提交以后，比特空间首先将客户提交意向以GX0206的方式通知商户服务器端（具体SUB_TYPE参见GX0206详情）。比特空间根据返回的补充参数中URL，将最终客户的浏览器重定向到该URL----也就是说，商户需要根据传入的GX0206数据消息，动态拼接出的相应的URL。如果未返回URL或者返回URL为空的场合，比特空间会将其视为不需要用户确认，后台自动将申请提交到相应的金融机构。
##### 3.5.2 输入参数 #####
无定制结果返回，直接将用户的浏览器重定向到合作机构预先给定的URL。
##### 3.5.3 输出结果 #####
无定制结果返回，直接将用户的浏览器重定向到合作机构预先给定的URL。

#### 3.6 合作机构查询、通知GX0205 ####
##### 3.6.1 接口描述 #####
可选。合作机构异步通知比特空间申请状态变化等。本调用有HTTP Digest验证的HTTP POST调用，用户名密码即科另行提供。

##### 3.6.2 输入参数 #####
```
"APP_ID" : "BCF02-150607-123456",
"SUB_TYPE" : "0001",
"EXTRA" : {
    ......
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_ID | 字符串 | 19 | 全局唯一的申请号
SUB_TYPE | 字符串 | 4 | 子消息类型，可根据合作机构业务线下另行协商定义
EXTRA | 集合 | - | 可选。由商户代入的额外键值对数据，可线下协商另行配置

同时，扩展部分可根据合作机构业务线下另行协商定义。目前已经与定义的SUB_TYPE包含如下几种场景:

子消息类型 | 备注 | 请求时扩展字段
-------|--------|--------
0001 | 用户确认通知:手续费/首付款支付完成 | TXN_ID ：全局唯一交易流水号<br />EXT_UID：外部交易唯一编号,如商户内部订单号或流水号等<br />RESULT：用户确认成功则为"YES",确认失败则为"NO"

##### 3.6.3 输出结果 #####
扩展部分可根据合作机构业务线下另行协商定义。目前已经与定义的SUB_TYPE包含如下几种场景:

子消息类型 | 备注  | 返回时扩展字段
-------|--------|--------
0001 | 用户确认通知:手续费/首付款支付完成 |  无

#### 3.7 比特空间查询、通知GX0206 ####
##### 3.7.1 接口描述 #####
可选。比特空间后台查询通知合作机构申请状态及变化，具体通知消息需与合作机构另行商定。安全起见，比特空间强烈建议合作机构采用带HTTP Digest验证的HTTP POST调用，用户名密码即科另行提供。比特空间建议合作机构实现HTTP Digest验证，参见GX0205。

##### 3.7.2 输入参数 #####
```
"APP_ID" : "BCF02-150607-123456",
"SUB_TYPE" : "0101",
"EXTRA" : {
    ......
}
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_ID | 字符串 | 19 | 全局唯一的申请号
SUB_TYPE | 字符串 | 4 | 子消息类型，可根据合作机构业务线下另行协商定义
EXTRA | 集合 | - | 可选。由商户代入的额外键值对数据，可线下协商另行配置

同时，扩展部分可根据合作机构业务线下另行协商定义。目前已经与定义的SUB_TYPE包含如下几种场景:

字段 | 备注 | 请求时扩展字段
-------|--------|--------
0101 | 申请提交通知 | USER_ID ： 用户哈希ID，由合作提供提供并保证其唯一性的用户身份标识<br />OPPT_ID ： 全局唯一商机ID，由合作机构在GX0200处传入的商机ID，比特空间会将其返回给合作机构用于商机跟踪<br />TXN_ID ：全局唯一交易流水号<br />LOAN_AMT：贷款金额<br />LOAN_TNR：贷款期限（月数）<br /> LOAN_DOWNPAY：贷款首付／手续费<br />APP_STATUS：当前申请状态（SAVE: 待提交、SBMT：已提交、DECL：已拒绝、APRV：已批准、DDWN：已放款、CANL：已取消、POFF：已还款毕、RESM:待重新提交、RETN:资料已打回）
0102 | 申请打回通知 | REASON ：打回原因
0103 | 申请拒绝通知 | REASON ：拒绝原因
0104 | 申请通过通知 | APRV_AMT ：批准金额<br />APRV_TNR ：批准期限
0105 | 申请放款通知 | DD_AMT ：批准金额<br />DD_TNR ：批准期限
0106 | 申请查询支付结果 | USER_ID ： 用户哈希ID，由合作提供提供并保证其唯一性的用户身份标识<br />OPPT_ID ： 全局唯一商机ID，由合作机构在GX0200处传入的商机ID，比特空间会将其返回给合作机构用于商机跟踪<br />TXN_ID ：全局唯一交易流水号<br />
0107 | 申请待重新提交 | REASON ：待重新提交原因
##### 3.7.3 输出结果 #####
扩展部分可根据合作机构业务线下另行协商定义。目前已经与定义的SUB_TYPE包含如下几种场景:

字段 | 备注 | 返回时扩展字段
-------|--------|--------
0101 | 申请提交通知 | REDI_URL：重定向URL（可选）
0102 | 申请打回通知 | 无
0103 | 申请拒绝通知 | 无
0104 | 申请通过通知 | 无
0105 | 申请放款通知 | 无
0106 | 申请查询支付结果 | TXN_ID ：全局唯一交易流水号<br />RESULT：确认成功则为"YES",确认失败则为"NO"
0107 | 申请待重新提交 | 无


#### 3.8 查询指定订单 GX0207 ####
##### 3.8.1 接口描述 #####
可选。合作机构查询某个用户的所有申请.安全起见，比特空间强烈建议合作机构采用带HTTP Digest验证的HTTP POST调用，用户名密码即科另行提供。比特空间建议合作机构实现HTTP Digest验证，参见GX0205。

##### 3.8.2 输入参数 #####
```
"USER_ID" : "ABC-12345",
"APP_ID": "BCF02",
"APP_NAME" : "保证金",
"APP_START_DATE" : "2015-05-01 00:00:00",
"APP_END_DATE" : "2015-05-01 10:10:10",
"LOAN_DOWNPAY_MIN" : "100",
"LOAN_DOWNPAY_MAX" : "9999",
"OPPT_ID" : "12345678901"
```
字段说明：

字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
USER_ID | 字符串 | - | 选填,用户哈希ID，由合作提供提供并保证其唯一性的用户身份标识.如果不填则搜索所有用户.
APP_ID | 字符串 | - | 选填,订单号,全局唯一的申请号.该字段开启了模糊查询,等效于 like %{APP_ID}%
APP_NAME | 字符串 | - | 选填,名称 (存款证明/保证金/存款证明+保证金).该字段开启了模糊查询,等效于 like %{APP_NAME}%
APP_START_DATE | 字符串 | YYYY-MM-DD HH:mm:SS | 选填,申请开始时间，等效于 {APP_DATE} >= {APP_START_DATE}
APP_END_DATE | 字符串 | YYYY-MM-DD HH:mm:SS | 选填,申请结束时间，等效于 {APP_DATE} <= {APP_END_DATE}
LOAN_DOWNPAY_MIN | 金额 | - | 选填,贷款首付最小额, 等效于 {LOAN_DOWNPAY} >= {LOAN_DOWNPAY_MIN}
LOAN_DOWNPAY_MAX | 金额 | - | 选填,贷款首付最大额, 等效于 {LOAN_DOWNPAY} <= {LOAN_DOWNPAY_MAX}
OPPT_ID | 字符串 | 32 | 全局商机唯一ID，比特空间会将其返回给合作机构用于商机跟踪

##### 3.8.3 输出结果 #####
```
"APP_LIST" : [
    {
        "APP_ID":"BCF02-150429-961143"
        "APP_DATE":"2015-05-01 10:10:10",
        "USER_ID":"ABC-12345",
        "PDT_CAT":"pdt001",
        "OPPT_ID":"12345678901",
        "APP_STATUS":"SAVE",
        "STATE_DESC":"待提交",
        "APP_NAME":"北银消费金融公司存款证明+保证金",
        "LOAN_AMT":"20000",
        "LOAN_TNR":"6",
        "LOAN_DOWNPAY":"1800"
    },
    {
        ...
    }
]
```
字段 | 类型 | 格式 | 备注
-------|--------|--------|-------
APP_ID | 字符串 | 19 | 订单号,全局唯一的申请号
APP_DATE | 字符串 | YYYY-MM-DD HH:mm:SS | 申请时间
USER_ID | 字符串 | 32 | 用户哈希ID，由合作提供提供并保证其唯一性的用户身份标识
PDT_CAT | 字符串 | 32 | 商品种类信息，比特空间与合作机构线下协商的产品种类代码
OPPT_ID | 字符串 | 32 | 全局商机唯一ID，比特空间会将其返回给合作机构用于商机跟踪
APP_STATUS | 字符串 | 4 | 当前申请状态（SAVE: 待提交 SBMT：已提交 DECL：已拒绝 APRV：已批准 DDWN：已放款 CANL：已取消 POFF：已还款毕 RESM:待重新提交 RETN:资料已打回）
STATE_DESC | 字符串 | － | 当前申请状态的中文描述
APP_NAME | 字符串 | 32 | 名称 (存款证明/保证金/存款证明+保证金)
LOAN_AMT | 金额 | － | 贷款金额
LOAN_TNR | 整数 | － | 贷款期限（月数）
LOAN_DOWNPAY | 金额 | － | 贷款首付／手续费


#### 3.9 商户跳入请求GX0208（带入订单数据） ####
##### 3.9.1 接口描述 #####
从合作机构网站调入比特空间申请页面, 并将必要的参数以HTTP GET的形式传递到比特空间的服务器上。
##### 3.9.2 输入参数 #####
其URL构成为：

序号 | 项目名 | 类型 | 格式 | 备注
-------|--------|--------|-------|-------
5 | 交易代码  | 字符串 | 32 | 固定值"GX0208"
6 | 扩展参数1  | 字符串 | 32 | USER_ID ： 用户哈希ID，由合作提供提供并保证其唯一性的用户身份标识
7 | 扩展参数2  | 字符串 | 32 | CHNL_ID ：商机渠道信息
8 | 扩展参数3  | 字符串 | 32 | PDT_CAT ：商品种类信息，比特空间与合作机构线下协商的产品种类代码
9 | 扩展参数4  | 字符串 | 32 | OPPT_ID ： 全局商机唯一ID，比特空间会将其返回给合作机构用于商机跟踪
10 | 扩展参数5  | 字符串 | 32 | orderid ： 订单ID，比特空间订单ID

示例URL如:

```
    http://www.geexfinance.com/merchant/service/refer/lvmama/e38b077cb3eb7a5c21599999c8e8bsba/GX0200/ABC-12345/chnl001/pdt001/oppt001/?orderid=BCF02-150714-469399
```
其中，数据如下：

序号 | 项目名 | 值
-------|--------|--------
1 | 基础URL  | http://www.geexfinance.com/merchant/service/(测试环境为http://test.geexfinance.com/merchant/service/)
2 | 动作名称  | refer
3 | 商户ID  | lvmama
4 | 商户公开哈系代码  | e38b077cb3eb7a5c21599999c8e8bsba
5 | 交易代码  | GX0208
6 | 扩展参数1 ：USER_ID | ABC-12345
7 | 扩展参数2 ：CHNL_ID | chnl_001
8 | 扩展参数3 ： PDT_CAT | pdt001
9 | 扩展参数4 ：OPPT_ID  | oppt001
10 | 扩展参数5 ：orderid  | BCF02-150714-469399

##### 3.9.3 输出结果 #####
直接将用户浏览器带入到预配置的着陆页面，并同时将订单数据导入。


### 4. 用户场景举例 ###
本节根据前述接口定义，特距离说明如何与即科现有服务配合进行交互。

##### 4.1 商户跳入请求 #####
接入即科的时候，驴妈妈生成如下URL直接链接至即科服务器即可：

```
http://www.geexfinance.com/merchant/service/refer/lvmama/e38b077cb3eb7a5c21599999c8e8bsba/GX0200/ABC-12345/chnl001/pdt001/oppt001/
```

##### 4.2 跳出通知 #####
对于跳出转接到驴妈妈的支付接口，即科会将如下格式的JSON数据，POST到驴妈妈提供的URL(待提供)上：

```
{
    "MERCHANT_ID" : "lvmama",
    "TXN_CODE" : "GX0204",
    "TIME_STAMP" : "2015-02-17 12:34:56",
    "DATA" : {
        "USER_ID" : "ABC-12345",
        "OPPT_ID" : "ABC-12345-0000000",
        "APP_ID" : "BCF02-150217-123456",
        "EXTRA" : {
            "LOAN_PDT" : "ABCD",
            "LOAN_AMT" : 9500,
            "LOAN_TNR" : 6,
            "LOAN_DOWNPAY" : 750,
            "APP_STATUS" : "SBMT"
        }
    }
}
```

正常情况下，驴妈妈需返回如下格式数据：

```
{
    "TXN_CODE" : "GX0204",
    "TIME_STAMP" : "2015-04-16 16:23:34",
    "ERROR_CODE" : 0,
    "MESSAGE" : "",
    "DATA" : {}
}
```


##### 4.3 支付完成通知 #####
对于支付完成接口，驴妈妈需按如下格式调用即科提供的URL（http://www.geexfinance.com/merchant/service/apis/lvmama/e38b077cb3eb7a5c21599999c8e8bsba/GX0205/）:

```
{
    "MERCHANT_ID" : "lvmama",
    "TXN_CODE" : "GX0205",
    "TIME_STAMP" : "2015-02-17 12:34:56",
    "DATA" : {
        "APP_ID" : "BCF02-150217-123456",
        "SUB_TYPE" : "0001",
        "NEW_STATUS" : "YES",
        "EXTRA" : {}
    }
}
```

正常情况下，即科需返回如下格式数据：

```
{
    "TXN_CODE" : "GX0205",
    "TIME_STAMP" : "2015-04-16 16:23:34",
    "ERROR_CODE" : 0,
    "MESSAGE" : "",
    "DATA" : {}
}
```

##### 4.4 商户对账请求 #####
比特空间会在预订时间发起面向商户的上一个自然日的数据对账调用请求，POST如下格式数据到驴妈妈提供的URL(待提供)。

```
{
    "MERCHANT_ID" : "lvmama",
    "TXN_CODE" : "GX0201",
    "TIME_STAMP" : "2015-02-17 12:34:56",
    "DATA" : {
        "APP_DATE" : "20150217"
    }
}
```

正常情况下，驴妈妈需返回如下格式数据：

```
{
    "TXN_CODE" : "GX0201",
    "TIME_STAMP" : "2015-04-16 16:23:34",
    "ERROR_CODE" : 0,
    "MESSAGE" : "",
    "DATA" : {
        "APP_DATE" : "20150217",
        "SYNC_DATE" : "20150220",
        "TOTAL" : 2,
        "RESULT" : {
            "APP_ID" : ["ABC01-20150217-123456","ABC01-20150217-000000"],
            "LOAN_PDT" : ["ABCD","ABCD"],
            "LOAN_AMT" : [9500,17500],
            "LOAN_TNR" : [6,12],
            "LOAN_DOWNPAY" : [0, 750],
            "CONFIRM_DATE" : ["2015-02-17 12:34:56","2015-02-18 12:34:56"],
            "APP_STATUS" : ["SBMT","APRV"],
            "EXT_UID" : ["1234567890-1", "1234567890-2"]
        }
    }
}
```

##### 4.5 对账完成通知 #####
比特空间会所有对账业务完成后，会POST如下格式数据到驴妈妈提供的URL(待提供)。

```
{
    "MERCHANT_ID" : "lvmama",
    "TXN_CODE" : "GX0203",
    "TIME_STAMP" : "2015-02-17 12:34:56",
    "DATA" : {
        "APP_DATE" : "20150217",
        "SYNC_DATE" : "20150220",
        "TOTAL" : 3,
        "COUNT_OK" : 2,
        "COUNT_NG" : 1,
        "RESULT" : {
            "APP_ID" : ["ABC01-20150217-123456"],
            "CONFLICT_CODE" : [100],
            "CONFLICT_MSG" : ["......"],
        }
}
```

正常情况下，驴妈妈需返回如下格式数据：

```
{
    "TXN_CODE" : "GX0203",
    "TIME_STAMP" : "2015-04-16 16:23:34",
    "ERROR_CODE" : 0,
    "MESSAGE" : "",
    "DATA" : {}
}
```